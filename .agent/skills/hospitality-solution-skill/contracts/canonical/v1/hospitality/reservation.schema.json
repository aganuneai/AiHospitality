{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/contracts/canonical/v1/hospitality/reservation.schema.json",
  "title": "Reservation Contracts",
  "type": "object",
  "oneOf": [
    { "$ref": "#/$defs/ReservationCreateRequest" },
    { "$ref": "#/$defs/ReservationCreateResponse" },
    { "$ref": "#/$defs/ReservationModifyRequest" },
    { "$ref": "#/$defs/ReservationCancelRequest" },
    { "$ref": "#/$defs/ReservationView" }
  ],
  "$defs": {
    "ReservationStatus": {
      "type": "string",
      "enum": ["PENDING", "CONFIRMED", "IN_HOUSE", "CHECKED_OUT", "CANCELLED", "NO_SHOW"]
    },

    "ReservationView": {
      "type": "object",
      "required": ["reservationId", "status", "stay", "roomTypeCode", "ratePlanCode", "total"],
      "properties": {
        "reservationId": { "type": "string", "minLength": 1, "maxLength": 64 },
        "pnr": { "type": "string", "minLength": 1, "maxLength": 64 },
        "status": { "$ref": "#/$defs/ReservationStatus" },
        "stay": {
          "type": "object",
          "required": ["checkIn", "checkOut", "adults"],
          "properties": {
            "checkIn": { "type": "string", "format": "date" },
            "checkOut": { "type": "string", "format": "date" },
            "adults": { "type": "integer", "minimum": 1, "maximum": 20 },
            "children": { "type": "integer", "minimum": 0, "maximum": 20 }
          },
          "additionalProperties": false
        },
        "primaryGuest": { "$ref": "https://example.com/contracts/canonical/v1/hospitality/guest-profile.schema.json" },
        "roomTypeCode": { "type": "string", "minLength": 1, "maxLength": 32 },
        "ratePlanCode": { "type": "string", "minLength": 1, "maxLength": 32 },
        "total": { "$ref": "https://example.com/contracts/canonical/v1/common/money.schema.json" },
        "policies": { "$ref": "https://example.com/contracts/canonical/v1/hospitality/policies.schema.json" }
      },
      "additionalProperties": true
    },

    "ReservationCreateRequest": {
      "type": "object",
      "required": ["context", "idempotencyKey", "quoteId", "pricingSignature", "primaryGuest"],
      "properties": {
        "context": { "$ref": "https://example.com/contracts/canonical/v1/common/context-envelope.schema.json" },
        "idempotencyKey": { "type": "string", "minLength": 8, "maxLength": 128 },
        "quoteId": { "type": "string", "minLength": 8, "maxLength": 128 },
        "pricingSignature": { "type": "string", "minLength": 8, "maxLength": 512 },
        "primaryGuest": { "$ref": "https://example.com/contracts/canonical/v1/hospitality/guest-profile.schema.json" },
        "specialRequests": { "type": "string", "maxLength": 2000 },
        "payment": {
          "type": "object",
          "properties": {
            "guaranteeType": { "type": "string", "enum": ["NONE", "CARD", "DEPOSIT"] },
            "token": { "type": "string", "minLength": 8, "maxLength": 512 }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "ReservationCreateResponse": {
      "type": "object",
      "required": ["context", "reservation"],
      "properties": {
        "context": { "$ref": "https://example.com/contracts/canonical/v1/common/context-envelope.schema.json" },
        "reservation": { "$ref": "#/$defs/ReservationView" },
        "warnings": { "type": "array", "items": { "type": "string", "maxLength": 256 } }
      },
      "additionalProperties": false
    },

    "ReservationModifyRequest": {
      "type": "object",
      "required": ["context", "idempotencyKey", "reservationId", "changes"],
      "properties": {
        "context": { "$ref": "https://example.com/contracts/canonical/v1/common/context-envelope.schema.json" },
        "idempotencyKey": { "type": "string", "minLength": 8, "maxLength": 128 },
        "reservationId": { "type": "string", "minLength": 1, "maxLength": 64 },
        "changes": {
          "type": "object",
          "properties": {
            "stay": {
              "type": "object",
              "properties": {
                "checkIn": { "type": "string", "format": "date" },
                "checkOut": { "type": "string", "format": "date" }
              },
              "additionalProperties": false
            },
            "guests": {
              "type": "object",
              "properties": {
                "adults": { "type": "integer", "minimum": 1, "maximum": 20 },
                "children": { "type": "integer", "minimum": 0, "maximum": 20 }
              },
              "additionalProperties": false
            },
            "specialRequests": { "type": "string", "maxLength": 2000 }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "ReservationCancelRequest": {
      "type": "object",
      "required": ["context", "idempotencyKey", "reservationId", "reason"],
      "properties": {
        "context": { "$ref": "https://example.com/contracts/canonical/v1/common/context-envelope.schema.json" },
        "idempotencyKey": { "type": "string", "minLength": 8, "maxLength": 128 },
        "reservationId": { "type": "string", "minLength": 1, "maxLength": 64 },
        "reason": { "type": "string", "minLength": 2, "maxLength": 256 }
      },
      "additionalProperties": false
    }
  }
}
